<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰€æœ‰å·¥å…·è¯¦æƒ…æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .tool-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }
        .tool-card h3 {
            margin: 0 0 10px 0;
            color: #007bff;
        }
        .tool-card .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-pending { background: #ffc107; }
        .tool-link {
            display: inline-block;
            margin-top: 10px;
            padding: 5px 10px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 3px;
            font-size: 12px;
        }
        .tool-link:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª æ‰€æœ‰å·¥å…·è¯¦æƒ…æµ‹è¯•</h1>
        
        <div class="info">
            <strong>æµ‹è¯•ç›®æ ‡:</strong> éªŒè¯æ•°æ®åº“ä¸­çš„æ‰€æœ‰å·¥å…·è¯¦æƒ…é¡µé¢æ˜¯å¦éƒ½å¯ä»¥æ­£å¸¸æ‰“å¼€ï¼Œä¸ä¼šå‡ºç°"æ‰¾ä¸åˆ°å·¥å…·"æˆ–mapé”™è¯¯ã€‚
        </div>

        <button class="test-btn" onclick="loadDatabase()">1. åŠ è½½æ•°æ®åº“</button>
        <button class="test-btn" onclick="testAllTools()">2. æµ‹è¯•æ‰€æœ‰å·¥å…·</button>
        <button class="test-btn" onclick="testDetailLoader()">3. æµ‹è¯•è¯¦æƒ…åŠ è½½å™¨</button>
        <button class="test-btn" onclick="generateToolLinks()">4. ç”Ÿæˆå·¥å…·é“¾æ¥</button>

        <div id="results"></div>
        <div id="tool-grid" class="tool-grid"></div>
    </div>

    <script src="ai-tools-database.js"></script>
    <script src="js/fast-detail-loader.js"></script>
    
    <script>
        let allTools = [];
        let testResults = {};

        function addResult(type, title, content) {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<h3>${title}</h3>${content}`;
            resultsDiv.appendChild(div);
        }

        function loadDatabase() {
            try {
                if (typeof aiToolsDatabase !== 'undefined') {
                    const db = aiToolsDatabase;
                    allTools = db.tools || [];
                    
                    addResult('success', 'âœ… æ•°æ®åº“åŠ è½½æˆåŠŸ', `
                        <p>å·¥å…·æ•°é‡: ${allTools.length}</p>
                        <p>æ¨¡å‹æ•°é‡: ${db.models ? db.models.length : 0}</p>
                        <p>Agentæ•°é‡: ${db.agents ? db.agents.length : 0}</p>
                        <p>åˆ†ç±»æ•°é‡: ${db.categories ? Object.keys(db.categories).length : 0}</p>
                    `);

                    // æ˜¾ç¤ºæ‰€æœ‰å·¥å…·åˆ—è¡¨
                    const toolsList = allTools.map(tool => 
                        `<li><strong>${tool.name}</strong> (${tool.id}) - ${tool.category}</li>`
                    ).join('');
                    
                    addResult('info', 'ğŸ“‹ å·¥å…·åˆ—è¡¨', `
                        <p>æ•°æ®åº“ä¸­åŒ…å«ä»¥ä¸‹å·¥å…·:</p>
                        <ul style="max-height: 200px; overflow-y: auto;">${toolsList}</ul>
                    `);
                } else {
                    addResult('error', 'âŒ æ•°æ®åº“æœªåŠ è½½', 'aiToolsDatabaseå˜é‡ä¸å­˜åœ¨');
                }
            } catch (error) {
                addResult('error', 'âŒ æ•°æ®åº“åŠ è½½å¤±è´¥', `é”™è¯¯: ${error.message}`);
            }
        }

        function testAllTools() {
            if (allTools.length === 0) {
                addResult('error', 'âŒ è¯·å…ˆåŠ è½½æ•°æ®åº“', '');
                return;
            }

            addResult('info', 'ğŸ”„ å¼€å§‹æµ‹è¯•æ‰€æœ‰å·¥å…·', `æ­£åœ¨æµ‹è¯• ${allTools.length} ä¸ªå·¥å…·çš„è¯¦æƒ…é¡µé¢æ¸²æŸ“...`);

            let successCount = 0;
            let errorCount = 0;
            const errors = [];

            allTools.forEach(tool => {
                try {
                    // æµ‹è¯•æ‰€æœ‰å¯èƒ½å¯¼è‡´mapé”™è¯¯çš„æ¸²æŸ“æ“ä½œ
                    
                    // 1. æµ‹è¯•åŸºæœ¬ä¿¡æ¯
                    const basicInfo = `
                        <h1>${tool.name || 'æœªçŸ¥å·¥å…·'}</h1>
                        <p>${tool.description || 'æš‚æ— æè¿°'}</p>
                        <p>è¯„åˆ†: ${tool.rating || 0}</p>
                        <p>æä¾›å•†: ${tool.provider || 'æœªçŸ¥'}</p>
                    `;

                    // 2. æµ‹è¯•åŠŸèƒ½åˆ—è¡¨æ¸²æŸ“
                    const featuresHtml = (tool.features || []).map(feature => `
                        <div class="feature-item">
                            <p>${feature}</p>
                        </div>
                    `).join('');

                    // 3. æµ‹è¯•ä¼˜ç¼ºç‚¹æ¸²æŸ“
                    let prosConsHtml = '';
                    if (tool.pros || tool.cons) {
                        prosConsHtml = '<div class="pros-cons">';
                        if (tool.pros) {
                            prosConsHtml += `<ul>${tool.pros.map(pro => `<li>${pro}</li>`).join('')}</ul>`;
                        }
                        if (tool.cons) {
                            prosConsHtml += `<ul>${tool.cons.map(con => `<li>${con}</li>`).join('')}</ul>`;
                        }
                        prosConsHtml += '</div>';
                    }

                    // 4. æµ‹è¯•æ ‡ç­¾æ¸²æŸ“
                    const tagsHtml = (tool.tags && tool.tags.length > 0) ? 
                        tool.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : '';

                    // 5. æµ‹è¯•ä½¿ç”¨åœºæ™¯æ¸²æŸ“
                    const scenariosHtml = (tool.tags && tool.tags.length > 0) ?
                        tool.tags.map(tag => `<li>${tag}ç›¸å…³çš„å·¥ä½œ</li>`).join('') : '';

                    // å¦‚æœæ‰€æœ‰æ¸²æŸ“éƒ½æˆåŠŸï¼Œè®°å½•ä¸ºæˆåŠŸ
                    testResults[tool.id] = {
                        status: 'success',
                        name: tool.name,
                        category: tool.category,
                        message: 'æ‰€æœ‰æ¸²æŸ“æµ‹è¯•é€šè¿‡'
                    };
                    successCount++;

                } catch (error) {
                    testResults[tool.id] = {
                        status: 'error',
                        name: tool.name,
                        category: tool.category,
                        message: error.message
                    };
                    errors.push(`${tool.name} (${tool.id}): ${error.message}`);
                    errorCount++;
                }
            });

            if (errorCount === 0) {
                addResult('success', 'âœ… æ‰€æœ‰å·¥å…·æµ‹è¯•é€šè¿‡', `
                    <p>æˆåŠŸæµ‹è¯•äº† ${successCount} ä¸ªå·¥å…·çš„è¯¦æƒ…é¡µé¢æ¸²æŸ“</p>
                    <p><strong>ç»“è®º:</strong> æ‰€æœ‰å·¥å…·è¯¦æƒ…é¡µé¢éƒ½å¯ä»¥æ­£å¸¸æ‰“å¼€ï¼Œä¸ä¼šå‡ºç°mapé”™è¯¯</p>
                `);
            } else {
                addResult('warning', 'âš ï¸ éƒ¨åˆ†å·¥å…·æµ‹è¯•å¤±è´¥', `
                    <p>æˆåŠŸ: ${successCount} ä¸ª</p>
                    <p>å¤±è´¥: ${errorCount} ä¸ª</p>
                    <p><strong>å¤±è´¥çš„å·¥å…·:</strong></p>
                    <pre>${errors.join('\n')}</pre>
                `);
            }

            // æ›´æ–°å·¥å…·ç½‘æ ¼æ˜¾ç¤º
            updateToolGrid();
        }

        function testDetailLoader() {
            if (allTools.length === 0) {
                addResult('error', 'âŒ è¯·å…ˆåŠ è½½æ•°æ®åº“', '');
                return;
            }

            if (typeof window.fastDetailLoader === 'undefined') {
                addResult('warning', 'âš ï¸ è¯¦æƒ…åŠ è½½å™¨æœªåŠ è½½', 'è·³è¿‡è¯¦æƒ…åŠ è½½å™¨æµ‹è¯•');
                return;
            }

            addResult('info', 'ğŸ”„ æµ‹è¯•è¯¦æƒ…åŠ è½½å™¨', `æ­£åœ¨æµ‹è¯• ${Math.min(5, allTools.length)} ä¸ªå·¥å…·çš„è¯¦æƒ…åŠ è½½...`);

            const testTools = allTools.slice(0, 5); // åªæµ‹è¯•å‰5ä¸ªå·¥å…·
            let promises = [];

            testTools.forEach(tool => {
                const promise = window.fastDetailLoader.getItemDetails(tool.id, 'tool')
                    .then(item => {
                        return {
                            id: tool.id,
                            name: tool.name,
                            status: 'success',
                            message: `æˆåŠŸåŠ è½½: ${item.name}`
                        };
                    })
                    .catch(error => {
                        return {
                            id: tool.id,
                            name: tool.name,
                            status: 'error',
                            message: `åŠ è½½å¤±è´¥: ${error.message}`
                        };
                    });
                promises.push(promise);
            });

            Promise.all(promises).then(results => {
                const successResults = results.filter(r => r.status === 'success');
                const errorResults = results.filter(r => r.status === 'error');

                if (errorResults.length === 0) {
                    addResult('success', 'âœ… è¯¦æƒ…åŠ è½½å™¨æµ‹è¯•é€šè¿‡', `
                        <p>æˆåŠŸåŠ è½½äº† ${successResults.length} ä¸ªå·¥å…·çš„è¯¦æƒ…</p>
                        <p>æ‰€æœ‰å·¥å…·éƒ½å¯ä»¥é€šè¿‡è¯¦æƒ…åŠ è½½å™¨æ­£å¸¸è®¿é—®</p>
                    `);
                } else {
                    addResult('warning', 'âš ï¸ éƒ¨åˆ†è¯¦æƒ…åŠ è½½å¤±è´¥', `
                        <p>æˆåŠŸ: ${successResults.length} ä¸ª</p>
                        <p>å¤±è´¥: ${errorResults.length} ä¸ª</p>
                        <p><strong>å¤±è´¥è¯¦æƒ…:</strong></p>
                        <pre>${errorResults.map(r => `${r.name}: ${r.message}`).join('\n')}</pre>
                    `);
                }
            });
        }

        function generateToolLinks() {
            if (allTools.length === 0) {
                addResult('error', 'âŒ è¯·å…ˆåŠ è½½æ•°æ®åº“', '');
                return;
            }

            const links = allTools.map(tool => 
                `<a href="tool-detail.html?id=${tool.id}&type=tool" target="_blank">${tool.name}</a>`
            ).join(' | ');

            addResult('info', 'ğŸ”— å·¥å…·è¯¦æƒ…é¡µé¢é“¾æ¥', `
                <p>ç‚¹å‡»ä»¥ä¸‹é“¾æ¥å¯ä»¥ç›´æ¥æµ‹è¯•å„ä¸ªå·¥å…·çš„è¯¦æƒ…é¡µé¢:</p>
                <div style="max-height: 200px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    ${links}
                </div>
                <p><strong>ä½¿ç”¨æ–¹æ³•:</strong> ç‚¹å‡»ä»»æ„å·¥å…·åç§°ï¼Œå¦‚æœèƒ½æ­£å¸¸æ‰“å¼€è¯¦æƒ…é¡µé¢ï¼Œè¯´æ˜è¯¥å·¥å…·å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p>
            `);
        }

        function updateToolGrid() {
            const gridDiv = document.getElementById('tool-grid');
            
            if (Object.keys(testResults).length === 0) {
                gridDiv.innerHTML = '';
                return;
            }

            const toolCards = allTools.map(tool => {
                const result = testResults[tool.id];
                const statusClass = result ? `status-${result.status}` : 'status-pending';
                const statusText = result ? result.message : 'æœªæµ‹è¯•';
                
                return `
                    <div class="tool-card">
                        <h3>
                            <span class="status-indicator ${statusClass}"></span>
                            ${tool.name}
                        </h3>
                        <p><strong>ID:</strong> ${tool.id}</p>
                        <p><strong>åˆ†ç±»:</strong> ${tool.category}</p>
                        <p><strong>çŠ¶æ€:</strong> ${statusText}</p>
                        <a href="tool-detail.html?id=${tool.id}&type=tool" target="_blank" class="tool-link">
                            æ‰“å¼€è¯¦æƒ…é¡µé¢
                        </a>
                    </div>
                `;
            }).join('');

            gridDiv.innerHTML = `
                <h2>ğŸ¯ å·¥å…·æµ‹è¯•ç»“æœ</h2>
                ${toolCards}
            `;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åŠ è½½æ•°æ®åº“
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                loadDatabase();
            }, 500);
        });
    </script>
</body>
</html>