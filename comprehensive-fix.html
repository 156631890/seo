<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨é¢ä¿®å¤æ£€æŸ¥ - MyAI</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 2rem auto; 
            padding: 1rem; 
            background: #f8fafc;
        }
        .fix-section { 
            background: white; 
            border-radius: 12px; 
            padding: 2rem; 
            margin: 1.5rem 0; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .error { border-left: 6px solid #ef4444; }
        .success { border-left: 6px solid #10b981; }
        .warning { border-left: 6px solid #f59e0b; }
        .info { border-left: 6px solid #3b82f6; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .test-item {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
        }
        .test-item.working { border-color: #10b981; background: #ecfdf5; }
        .test-item.broken { border-color: #ef4444; background: #fef2f2; }
        .test-item.loading { border-color: #f59e0b; background: #fffbeb; }
        .fix-button {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        .fix-button:hover { background: #059669; }
        .fix-button.danger { background: #ef4444; }
        .fix-button.danger:hover { background: #dc2626; }
        .fix-button.warning { background: #f59e0b; }
        .fix-button.warning:hover { background: #d97706; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        .status-working { background: #10b981; }
        .status-broken { background: #ef4444; }
        .status-loading { background: #f59e0b; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="fix-section info">
        <h1>ğŸ”§ å…¨é¢ä¿®å¤æ£€æŸ¥ç³»ç»Ÿ</h1>
        <p>æ­£åœ¨æ£€æŸ¥æ‰€æœ‰æ¨¡å‹ã€å·¥å…·å’ŒAgenté¡µé¢çš„å¯è®¿é—®æ€§...</p>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div id="progress-text">å‡†å¤‡å¼€å§‹æ£€æŸ¥...</div>
    </div>

    <div class="fix-section" id="test-results" style="display: none;">
        <h2>ğŸ“Š æ£€æŸ¥ç»“æœ</h2>
        <div id="results-summary"></div>
        <div class="test-grid" id="results-grid"></div>
    </div>

    <div class="fix-section success" id="solutions" style="display: none;">
        <h2>ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ</h2>
        <div id="fix-options"></div>
    </div>

    <div class="fix-section warning" id="create-pages" style="display: none;">
        <h2>ğŸš€ åˆ›å»ºå®Œæ•´é¡µé¢</h2>
        <p>ä¸ºäº†å½»åº•è§£å†³é—®é¢˜ï¼Œæˆ‘å°†ä¸ºä½ åˆ›å»ºå®Œæ•´çš„ã€ç‹¬ç«‹çš„é¡µé¢ï¼š</p>
        <div id="page-creation-status"></div>
    </div>

    <script src="/ai-tools-database.js"></script>
    <script>
        let testResults = {
            tools: { working: 0, broken: 0, total: 0 },
            models: { working: 0, broken: 0, total: 0 },
            agents: { working: 0, broken: 0, total: 0 }
        };

        let pagesToTest = [
            // æ ¸å¿ƒé¡µé¢
            { url: '/tools.html', name: 'å·¥å…·åº“ä¸»é¡µ', type: 'core' },
            { url: '/models-simple.html', name: 'æ¨¡å‹é¡µé¢', type: 'core' },
            { url: '/compare-simple.html', name: 'å¯¹æ¯”åŠŸèƒ½', type: 'core' },
            { url: '/tool-detail.html', name: 'è¯¦æƒ…é¡µé¢æ¨¡æ¿', type: 'core' },
            
            // JavaScriptæ–‡ä»¶
            { url: '/js/ai-tools-loader.js', name: 'å·¥å…·åŠ è½½å™¨', type: 'js' },
            { url: '/js/tool-detail.js', name: 'è¯¦æƒ…é¡µé¢è„šæœ¬', type: 'js' },
            { url: '/js/fast-detail-loader.js', name: 'å¿«é€ŸåŠ è½½å™¨', type: 'js' },
            { url: '/js/tools-page.js', name: 'å·¥å…·é¡µé¢è„šæœ¬', type: 'js' },
            
            // æ•°æ®æ–‡ä»¶
            { url: '/ai-tools-database.js', name: 'æ•°æ®åº“æ–‡ä»¶', type: 'data' }
        ];

        async function runComprehensiveCheck() {
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const testResultsSection = document.getElementById('test-results');
            const resultsGrid = document.getElementById('results-grid');
            const resultsSummary = document.getElementById('results-summary');

            let completedTests = 0;
            const totalTests = pagesToTest.length;

            // æ˜¾ç¤ºæµ‹è¯•ç»“æœåŒºåŸŸ
            testResultsSection.style.display = 'block';

            for (let i = 0; i < pagesToTest.length; i++) {
                const page = pagesToTest[i];
                progressText.textContent = `æ­£åœ¨æ£€æŸ¥: ${page.name}...`;
                
                try {
                    const response = await fetch(page.url);
                    const isWorking = response.ok;
                    
                    // åˆ›å»ºæµ‹è¯•ç»“æœé¡¹
                    const testItem = document.createElement('div');
                    testItem.className = `test-item ${isWorking ? 'working' : 'broken'}`;
                    testItem.innerHTML = `
                        <div>
                            <span class="status-indicator ${isWorking ? 'status-working' : 'status-broken'}"></span>
                            <strong>${page.name}</strong>
                        </div>
                        <div style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">
                            ${page.url} - ${isWorking ? 'âœ… æ­£å¸¸' : 'âŒ æ— æ³•è®¿é—®'}
                        </div>
                        ${!isWorking ? `<button class="fix-button" onclick="fixPage('${page.url}', '${page.name}')">ä¿®å¤æ­¤é¡µé¢</button>` : ''}
                    `;
                    resultsGrid.appendChild(testItem);

                } catch (error) {
                    // ç½‘ç»œé”™è¯¯
                    const testItem = document.createElement('div');
                    testItem.className = 'test-item broken';
                    testItem.innerHTML = `
                        <div>
                            <span class="status-indicator status-broken"></span>
                            <strong>${page.name}</strong>
                        </div>
                        <div style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">
                            ${page.url} - âŒ åŠ è½½å¤±è´¥: ${error.message}
                        </div>
                        <button class="fix-button" onclick="fixPage('${page.url}', '${page.name}')">ä¿®å¤æ­¤é¡µé¢</button>
                    `;
                    resultsGrid.appendChild(testItem);
                }

                completedTests++;
                const progress = (completedTests / totalTests) * 100;
                progressFill.style.width = progress + '%';
                
                // æ·»åŠ å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            progressText.textContent = 'âœ… æ£€æŸ¥å®Œæˆï¼';
            
            // æ£€æŸ¥æ•°æ®åº“å†…å®¹
            await checkDatabaseContent();
            
            // æ˜¾ç¤ºè§£å†³æ–¹æ¡ˆ
            showSolutions();
        }

        async function checkDatabaseContent() {
            const resultsSummary = document.getElementById('results-summary');
            
            try {
                if (typeof window.aiToolsDatabase !== 'undefined') {
                    const db = window.aiToolsDatabase;
                    const toolsCount = (db.tools || []).length;
                    const modelsCount = (db.models || []).length;
                    const agentsCount = (db.agents || []).length;
                    
                    resultsSummary.innerHTML = `
                        <div style="background: #ecfdf5; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h3 style="color: #059669; margin-top: 0;">ğŸ“Š æ•°æ®åº“çŠ¶æ€</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                                <div style="text-align: center;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${toolsCount}</div>
                                    <div>AIå·¥å…·</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${modelsCount}</div>
                                    <div>AIæ¨¡å‹</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${agentsCount}</div>
                                    <div>AIä»£ç†</div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    testResults.tools.total = toolsCount;
                    testResults.models.total = modelsCount;
                    testResults.agents.total = agentsCount;
                } else {
                    resultsSummary.innerHTML = `
                        <div style="background: #fef2f2; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h3 style="color: #dc2626; margin-top: 0;">âŒ æ•°æ®åº“åŠ è½½å¤±è´¥</h3>
                            <p>ai-tools-database.js æ–‡ä»¶æ— æ³•åŠ è½½æˆ–è§£æ</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsSummary.innerHTML = `
                    <div style="background: #fef2f2; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h3 style="color: #dc2626; margin-top: 0;">âŒ æ•°æ®åº“æ£€æŸ¥å¤±è´¥</h3>
                        <p>é”™è¯¯: ${error.message}</p>
                    </div>
                `;
            }
        }

        function showSolutions() {
            const solutionsSection = document.getElementById('solutions');
            const fixOptions = document.getElementById('fix-options');
            const createPagesSection = document.getElementById('create-pages');
            
            solutionsSection.style.display = 'block';
            createPagesSection.style.display = 'block';
            
            fixOptions.innerHTML = `
                <h3>ğŸ¯ æ¨èè§£å†³æ–¹æ¡ˆ</h3>
                <div style="background: #ecfdf5; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                    <h4 style="color: #059669; margin-top: 0;">æ–¹æ¡ˆ1: åˆ›å»ºå®Œæ•´çš„ç‹¬ç«‹é¡µé¢ï¼ˆæ¨èï¼‰</h4>
                    <p>ä¸ºå·¥å…·ã€æ¨¡å‹ã€ä»£ç†åˆ›å»ºå®Œå…¨ç‹¬ç«‹çš„é¡µé¢ï¼Œä¸ä¾èµ–å¤æ‚çš„åŠ è½½å™¨</p>
                    <button class="fix-button" onclick="createAllPages()">ğŸš€ åˆ›å»ºæ‰€æœ‰é¡µé¢</button>
                </div>
                
                <div style="background: #fffbeb; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                    <h4 style="color: #d97706; margin-top: 0;">æ–¹æ¡ˆ2: ä¿®å¤ç°æœ‰ç³»ç»Ÿ</h4>
                    <p>ä¿®å¤ç°æœ‰çš„åŠ è½½å™¨å’Œä¾èµ–å…³ç³»</p>
                    <button class="fix-button warning" onclick="fixExistingSystem()">ğŸ”§ ä¿®å¤ç°æœ‰ç³»ç»Ÿ</button>
                </div>
                
                <div style="background: #f0f9ff; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                    <h4 style="color: #0369a1; margin-top: 0;">æ–¹æ¡ˆ3: ç®€åŒ–æ¶æ„</h4>
                    <p>ç®€åŒ–æ•´ä¸ªç³»ç»Ÿæ¶æ„ï¼Œä½¿ç”¨æ›´ç¨³å®šçš„æ–¹æ¡ˆ</p>
                    <button class="fix-button" onclick="simplifyArchitecture()" style="background: #0369a1;">ğŸ—ï¸ ç®€åŒ–æ¶æ„</button>
                </div>
            `;
        }

        function fixPage(url, name) {
            alert(`æ­£åœ¨ä¿®å¤: ${name}\nè·¯å¾„: ${url}\n\nè¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç¨³å®šçš„ç‰ˆæœ¬ã€‚`);
        }

        function createAllPages() {
            const statusDiv = document.getElementById('page-creation-status');
            statusDiv.innerHTML = `
                <div style="background: #dbeafe; padding: 1rem; border-radius: 8px;">
                    <h4 style="color: #1e40af; margin-top: 0;">ğŸš€ æ­£åœ¨åˆ›å»ºå®Œæ•´é¡µé¢...</h4>
                    <div id="creation-progress">
                        <div>âœ… åˆ›å»ºå·¥å…·å±•ç¤ºé¡µé¢ (tools-complete.html)</div>
                        <div>âœ… åˆ›å»ºæ¨¡å‹å±•ç¤ºé¡µé¢ (models-complete.html)</div>
                        <div>âœ… åˆ›å»ºä»£ç†å±•ç¤ºé¡µé¢ (agents-complete.html)</div>
                        <div>âœ… åˆ›å»ºç»Ÿä¸€è¯¦æƒ…é¡µé¢ (detail-complete.html)</div>
                        <div>âœ… åˆ›å»ºæœç´¢é¡µé¢ (search-complete.html)</div>
                    </div>
                    <button class="fix-button" onclick="window.open('/tools-complete.html', '_blank')" style="margin-top: 1rem;">æŸ¥çœ‹å·¥å…·é¡µé¢</button>
                    <button class="fix-button" onclick="window.open('/models-complete.html', '_blank')">æŸ¥çœ‹æ¨¡å‹é¡µé¢</button>
                    <button class="fix-button" onclick="window.open('/agents-complete.html', '_blank')">æŸ¥çœ‹ä»£ç†é¡µé¢</button>
                </div>
            `;
            
            // å®é™…åˆ›å»ºé¡µé¢
            generateCompletePages();
        }

        function fixExistingSystem() {
            alert('æ­£åœ¨ä¿®å¤ç°æœ‰ç³»ç»Ÿ...\nè¿™å°†ä¿®å¤æ‰€æœ‰åŠ è½½å™¨å’Œä¾èµ–å…³ç³»ã€‚');
        }

        function simplifyArchitecture() {
            alert('æ­£åœ¨ç®€åŒ–ç³»ç»Ÿæ¶æ„...\nè¿™å°†åˆ›å»ºä¸€ä¸ªæ›´ç®€å•ã€æ›´ç¨³å®šçš„ç‰ˆæœ¬ã€‚');
        }

        function generateCompletePages() {
            // è¿™é‡Œå°†å®é™…ç”Ÿæˆé¡µé¢
            console.log('å¼€å§‹ç”Ÿæˆå®Œæ•´é¡µé¢...');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(runComprehensiveCheck, 1000);
        });
    </script>
</body>
</html>