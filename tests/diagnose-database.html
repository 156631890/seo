<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åº“è¯Šæ–­å·¥å…·</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1000px; 
            margin: 2rem auto; 
            padding: 1rem; 
            background: #f8fafc;
        }
        .diagnostic-card { 
            background: white; 
            border-radius: 8px; 
            padding: 1.5rem; 
            margin: 1rem 0; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        .warning { border-left: 4px solid #f59e0b; }
        .info { border-left: 4px solid #3b82f6; }
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .stat-item {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #10b981;
        }
        .fix-button {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        .fix-button:hover { background: #059669; }
        .fix-button.warning { background: #f59e0b; }
        .fix-button.warning:hover { background: #d97706; }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.9rem;
        }
        .sample-data {
            max-height: 300px;
            overflow-y: auto;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
        }
    </style>
</head>
<body>
    <h1>ğŸ” AIå·¥å…·æ•°æ®åº“è¯Šæ–­æŠ¥å‘Š</h1>
    
    <div class="diagnostic-card info">
        <h2>ğŸ“Š æ•°æ®åº“æ¦‚è§ˆ</h2>
        <div id="database-overview">æ­£åœ¨åŠ è½½æ•°æ®åº“...</div>
    </div>

    <div class="diagnostic-card" id="data-stats">
        <h2>ğŸ“ˆ æ•°æ®ç»Ÿè®¡</h2>
        <div class="stat-grid" id="stats-grid">
            <!-- ç»Ÿè®¡æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>

    <div class="diagnostic-card" id="issues-card" style="display: none;">
        <h2>âš ï¸ å‘ç°çš„é—®é¢˜</h2>
        <div id="issues-list">
            <!-- é—®é¢˜åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>

    <div class="diagnostic-card success" id="solutions-card" style="display: none;">
        <h2>ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ</h2>
        <div id="solutions-list">
            <!-- è§£å†³æ–¹æ¡ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>

    <div class="diagnostic-card info">
        <h2>ğŸ’¡ ä¸ºä»€ä¹ˆä¸éœ€è¦è´­ä¹°æ•°æ®åº“ï¼Ÿ</h2>
        <p><strong>ä½ çš„ç½‘ç«™ä½¿ç”¨çš„æ˜¯é™æ€æ–‡ä»¶æ•°æ®åº“ï¼Œè¿™æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼š</strong></p>
        <ul>
            <li>âœ… <strong>å®Œå…¨å…è´¹</strong> - æ— éœ€æ”¯ä»˜æ•°æ®åº“è´¹ç”¨</li>
            <li>âœ… <strong>é«˜æ€§èƒ½</strong> - ç›´æ¥ä»CDNåŠ è½½ï¼Œé€Ÿåº¦æå¿«</li>
            <li>âœ… <strong>æ— æœåŠ¡å™¨</strong> - å¯ä»¥éƒ¨ç½²åˆ°ä»»ä½•é™æ€æ‰˜ç®¡å¹³å°</li>
            <li>âœ… <strong>æ˜“äºç»´æŠ¤</strong> - æ•°æ®å­˜å‚¨åœ¨JavaScriptæ–‡ä»¶ä¸­</li>
            <li>âœ… <strong>ç‰ˆæœ¬æ§åˆ¶</strong> - å¯ä»¥ç”¨Gitè·Ÿè¸ªæ•°æ®å˜åŒ–</li>
            <li>âœ… <strong>ç¦»çº¿è®¿é—®</strong> - æ•°æ®ç¼“å­˜åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­</li>
        </ul>
        
        <p><strong>é€‚åˆçš„åœºæ™¯ï¼š</strong></p>
        <ul>
            <li>ğŸ“š å†…å®¹å±•ç¤ºç½‘ç«™ï¼ˆå¦‚ä½ çš„AIå·¥å…·åˆé›†ï¼‰</li>
            <li>ğŸ” æœç´¢å’Œç­›é€‰åŠŸèƒ½</li>
            <li>ğŸ“Š æ•°æ®å¯¹æ¯”å’Œåˆ†æ</li>
            <li>ğŸ“± ç§»åŠ¨ç«¯å‹å¥½çš„è½»é‡çº§åº”ç”¨</li>
        </ul>
    </div>

    <div class="diagnostic-card warning">
        <h2>ğŸš¨ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h2>
        <div id="common-issues">
            <h3>é—®é¢˜1: æ¨¡å‹é¡µé¢æ‰“ä¸å¼€</h3>
            <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
            <ul>
                <li>æ•°æ®æ–‡ä»¶åŠ è½½å¤±è´¥</li>
                <li>JavaScripté”™è¯¯é˜»æ­¢é¡µé¢æ¸²æŸ“</li>
                <li>è·¯ç”±é…ç½®é—®é¢˜</li>
            </ul>
            
            <h3>é—®é¢˜2: æ•°æ®æ˜¾ç¤ºä¸å®Œæ•´</h3>
            <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
            <ul>
                <li>æ•°æ®æ–‡ä»¶æŸåæˆ–æ ¼å¼é”™è¯¯</li>
                <li>å¼‚æ­¥åŠ è½½é—®é¢˜</li>
                <li>ç¼“å­˜é—®é¢˜</li>
            </ul>
        </div>
    </div>

    <script src="/ai-tools-database.js"></script>
    <script>
        let diagnosticResults = {
            database: null,
            issues: [],
            solutions: [],
            stats: {}
        };

        function runDiagnostics() {
            const overviewEl = document.getElementById('database-overview');
            const statsGrid = document.getElementById('stats-grid');
            const issuesCard = document.getElementById('issues-card');
            const issuesList = document.getElementById('issues-list');
            const solutionsCard = document.getElementById('solutions-card');
            const solutionsList = document.getElementById('solutions-list');

            try {
                // æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åŠ è½½
                if (typeof window.aiToolsDatabase === 'undefined') {
                    throw new Error('æ•°æ®åº“æœªåŠ è½½ - ai-tools-database.jsæ–‡ä»¶å¯èƒ½æœ‰é—®é¢˜');
                }

                const db = window.aiToolsDatabase;
                diagnosticResults.database = db;

                // åŸºç¡€ç»Ÿè®¡
                const stats = {
                    categories: Object.keys(db.categories || {}).length,
                    tools: (db.tools || []).length,
                    models: (db.models || []).length,
                    agents: (db.agents || []).length,
                    modelTypes: Object.keys(db.modelTypes || {}).length,
                    agentTypes: Object.keys(db.agentTypes || {}).length
                };

                diagnosticResults.stats = stats;

                // æ˜¾ç¤ºæ¦‚è§ˆ
                overviewEl.innerHTML = `
                    <div class="success">
                        âœ… æ•°æ®åº“åŠ è½½æˆåŠŸï¼<br>
                        ğŸ“ æ•°æ®åº“å¤§å°: ${JSON.stringify(db).length.toLocaleString()} å­—ç¬¦<br>
                        ğŸ•’ åŠ è½½æ—¶é—´: ${Date.now() - window.performance.timing.navigationStart}ms
                    </div>
                `;

                // æ˜¾ç¤ºç»Ÿè®¡
                statsGrid.innerHTML = `
                    <div class="stat-item">
                        <div class="stat-number">${stats.categories}</div>
                        <div>å·¥å…·åˆ†ç±»</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${stats.tools}</div>
                        <div>AIå·¥å…·</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${stats.models}</div>
                        <div>AIæ¨¡å‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${stats.agents}</div>
                        <div>AIä»£ç†</div>
                    </div>
                `;

                // æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
                checkDataIntegrity(db, stats);

                // æ˜¾ç¤ºé—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
                if (diagnosticResults.issues.length > 0) {
                    issuesCard.style.display = 'block';
                    issuesList.innerHTML = diagnosticResults.issues.map(issue => 
                        `<div class="error">âŒ ${issue}</div>`
                    ).join('');
                }

                if (diagnosticResults.solutions.length > 0) {
                    solutionsCard.style.display = 'block';
                    solutionsList.innerHTML = diagnosticResults.solutions.map(solution => 
                        `<div class="info">ğŸ’¡ ${solution}</div>`
                    ).join('');
                }

                // ç”Ÿæˆä¿®å¤å»ºè®®
                generateFixSuggestions();

            } catch (error) {
                overviewEl.innerHTML = `
                    <div class="error">
                        âŒ æ•°æ®åº“åŠ è½½å¤±è´¥: ${error.message}<br>
                        <button class="fix-button warning" onclick="location.reload()">é‡æ–°åŠ è½½é¡µé¢</button>
                    </div>
                `;
                console.error('è¯Šæ–­å¤±è´¥:', error);
            }
        }

        function checkDataIntegrity(db, stats) {
            // æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
            if (stats.tools === 0) {
                diagnosticResults.issues.push('å·¥å…·æ•°æ®ä¸ºç©º - å¯èƒ½éœ€è¦è¿è¡Œæ•°æ®ç”Ÿæˆè„šæœ¬');
                diagnosticResults.solutions.push('è¿è¡Œ generate-52-tools.js è„šæœ¬ç”Ÿæˆå·¥å…·æ•°æ®');
            }

            if (stats.models === 0) {
                diagnosticResults.issues.push('æ¨¡å‹æ•°æ®ä¸ºç©º - å¯èƒ½éœ€è¦è¿è¡Œæ•°æ®ç”Ÿæˆè„šæœ¬');
                diagnosticResults.solutions.push('è¿è¡Œ generate-24-models.js è„šæœ¬ç”Ÿæˆæ¨¡å‹æ•°æ®');
            }

            if (stats.agents === 0) {
                diagnosticResults.issues.push('ä»£ç†æ•°æ®ä¸ºç©º - å¯èƒ½éœ€è¦è¿è¡Œæ•°æ®ç”Ÿæˆè„šæœ¬');
                diagnosticResults.solutions.push('è¿è¡Œ generate-29-agents.js è„šæœ¬ç”Ÿæˆä»£ç†æ•°æ®');
            }

            // æ£€æŸ¥æ•°æ®ç»“æ„
            if (db.tools && db.tools.length > 0) {
                const sampleTool = db.tools[0];
                const requiredFields = ['id', 'name', 'description', 'category'];
                const missingFields = requiredFields.filter(field => !sampleTool[field]);
                
                if (missingFields.length > 0) {
                    diagnosticResults.issues.push(`å·¥å…·æ•°æ®ç¼ºå°‘å¿…è¦å­—æ®µ: ${missingFields.join(', ')}`);
                }
            }

            // æ£€æŸ¥æ¨¡å‹æ•°æ®ç»“æ„
            if (db.models && db.models.length > 0) {
                const sampleModel = db.models[0];
                const requiredFields = ['id', 'name', 'provider', 'type'];
                const missingFields = requiredFields.filter(field => !sampleModel[field]);
                
                if (missingFields.length > 0) {
                    diagnosticResults.issues.push(`æ¨¡å‹æ•°æ®ç¼ºå°‘å¿…è¦å­—æ®µ: ${missingFields.join(', ')}`);
                }
            }
        }

        function generateFixSuggestions() {
            const solutionsList = document.getElementById('solutions-list');
            
            let fixButtons = '';
            
            if (diagnosticResults.stats.tools === 0) {
                fixButtons += '<button class="fix-button" onclick="generateTools()">ğŸ› ï¸ ç”Ÿæˆå·¥å…·æ•°æ®</button>';
            }
            
            if (diagnosticResults.stats.models === 0) {
                fixButtons += '<button class="fix-button" onclick="generateModels()">ğŸ§  ç”Ÿæˆæ¨¡å‹æ•°æ®</button>';
            }
            
            if (diagnosticResults.stats.agents === 0) {
                fixButtons += '<button class="fix-button" onclick="generateAgents()">ğŸ¤– ç”Ÿæˆä»£ç†æ•°æ®</button>';
            }

            fixButtons += '<button class="fix-button warning" onclick="showDataSample()">ğŸ“‹ æŸ¥çœ‹æ•°æ®æ ·æœ¬</button>';
            fixButtons += '<button class="fix-button" onclick="testPages()">ğŸ§ª æµ‹è¯•é¡µé¢åŠŸèƒ½</button>';

            if (solutionsList && fixButtons) {
                solutionsList.innerHTML += `<div style="margin-top: 1rem;">${fixButtons}</div>`;
            }
        }

        function generateTools() {
            alert('æ­£åœ¨ç”Ÿæˆå·¥å…·æ•°æ®...\nè¯·åœ¨æ§åˆ¶å°è¿è¡Œ: node generate-52-tools.js');
            window.open('/generate-52-tools.js', '_blank');
        }

        function generateModels() {
            alert('æ­£åœ¨ç”Ÿæˆæ¨¡å‹æ•°æ®...\nè¯·åœ¨æ§åˆ¶å°è¿è¡Œ: node generate-24-models.js');
            window.open('/generate-24-models.js', '_blank');
        }

        function generateAgents() {
            alert('æ­£åœ¨ç”Ÿæˆä»£ç†æ•°æ®...\nè¯·åœ¨æ§åˆ¶å°è¿è¡Œ: node generate-29-agents.js');
            window.open('/generate-29-agents.js', '_blank');
        }

        function showDataSample() {
            const db = diagnosticResults.database;
            const sampleData = {
                categories: Object.keys(db.categories || {}).slice(0, 3),
                tools: (db.tools || []).slice(0, 2),
                models: (db.models || []).slice(0, 2),
                agents: (db.agents || []).slice(0, 2)
            };

            const popup = window.open('', '_blank', 'width=800,height=600');
            popup.document.write(`
                <html>
                <head><title>æ•°æ®æ ·æœ¬</title></head>
                <body style="font-family: monospace; padding: 20px;">
                    <h2>æ•°æ®åº“æ ·æœ¬</h2>
                    <pre>${JSON.stringify(sampleData, null, 2)}</pre>
                </body>
                </html>
            `);
        }

        function testPages() {
            const testUrls = [
                '/tools.html',
                '/compare-simple.html',
                '/tool-detail.html',
                '/test-tools-page.html'
            ];

            testUrls.forEach(url => {
                window.open(url, '_blank');
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œè¯Šæ–­
        window.addEventListener('load', () => {
            setTimeout(runDiagnostics, 500);
        });
    </script>
</body>
</html>