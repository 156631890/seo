<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics 测试页面</title>
    
    <!-- Google Search Console 验证 -->
    <meta name="google-site-verification" content="IyyiuJxBRqr62v-cPzO7vqonf-d6v2rnzgNK8HzO1Bs" />
    
    <!-- Google Analytics (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX');
    </script>
    
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; }
        .test-section { background: #f8f9fa; padding: 1.5rem; margin: 1rem 0; border-radius: 8px; }
        .test-button { background: #007bff; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; margin: 0.5rem; }
        .test-button:hover { background: #0056b3; }
        .status { padding: 0.5rem; margin: 0.5rem 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        #log { background: #f8f9fa; padding: 1rem; border-radius: 4px; max-height: 300px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>
    <h1>🔍 Google Analytics 测试页面</h1>
    
    <div class="test-section">
        <h2>📊 Analytics 状态检查</h2>
        <div id="analytics-status"></div>
        <button class="test-button" onclick="checkAnalyticsStatus()">检查Analytics状态</button>
    </div>

    <div class="test-section">
        <h2>🎯 事件跟踪测试</h2>
        <button class="test-button" onclick="testCustomEvent()">测试自定义事件</button>
        <button class="test-button" onclick="testPageView()">测试页面浏览</button>
        <button class="test-button" onclick="testUserEngagement()">测试用户参与</button>
        <button class="test-button" onclick="testConversion()">测试转化事件</button>
    </div>

    <div class="test-section">
        <h2>🔗 链接跟踪测试</h2>
        <a href="https://google.com" target="_blank" class="test-button" style="text-decoration: none; display: inline-block;">测试外部链接</a>
        <a href="/tools.html" class="test-button" style="text-decoration: none; display: inline-block;">测试内部链接</a>
    </div>

    <div class="test-section">
        <h2>📝 搜索测试</h2>
        <input type="search" id="test-search" placeholder="输入搜索词测试..." style="padding: 0.5rem; margin-right: 0.5rem;">
        <button class="test-button" onclick="testSearch()">测试搜索</button>
    </div>

    <div class="test-section">
        <h2>📋 测试日志</h2>
        <button class="test-button" onclick="clearLog()">清空日志</button>
        <div id="log"></div>
    </div>

    <script>
        // 日志函数
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.className = type;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // 检查Analytics状态
        function checkAnalyticsStatus() {
            const statusDiv = document.getElementById('analytics-status');
            
            if (typeof gtag === 'undefined') {
                statusDiv.innerHTML = '<div class="status error">❌ Google Analytics 未加载</div>';
                log('Analytics检查失败: gtag未定义', 'error');
                return;
            }

            if (typeof dataLayer === 'undefined') {
                statusDiv.innerHTML = '<div class="status error">❌ dataLayer 未初始化</div>';
                log('Analytics检查失败: dataLayer未定义', 'error');
                return;
            }

            statusDiv.innerHTML = '<div class="status success">✅ Google Analytics 正常运行</div>';
            log('Analytics状态检查通过', 'success');
            
            // 检查配置
            log(`dataLayer长度: ${dataLayer.length}`, 'info');
            log(`最新dataLayer条目: ${JSON.stringify(dataLayer[dataLayer.length - 1])}`, 'info');
        }

        // 测试自定义事件
        function testCustomEvent() {
            if (typeof gtag === 'undefined') {
                log('测试失败: gtag未加载', 'error');
                return;
            }

            gtag('event', 'test_custom_event', {
                event_category: 'testing',
                event_label: 'analytics_test_page',
                value: 1
            });
            
            log('发送自定义事件: test_custom_event', 'success');
        }

        // 测试页面浏览
        function testPageView() {
            if (typeof gtag === 'undefined') {
                log('测试失败: gtag未加载', 'error');
                return;
            }

            gtag('config', 'G-XXXXXXXXXX', {
                page_title: 'Analytics Test Page',
                page_location: window.location.href
            });
            
            log('发送页面浏览事件', 'success');
        }

        // 测试用户参与
        function testUserEngagement() {
            if (typeof gtag === 'undefined') {
                log('测试失败: gtag未加载', 'error');
                return;
            }

            gtag('event', 'engagement_time', {
                name: 'engagement_time',
                value: 30000 // 30秒
            });
            
            log('发送用户参与事件: 30秒', 'success');
        }

        // 测试转化事件
        function testConversion() {
            if (typeof gtag === 'undefined') {
                log('测试失败: gtag未加载', 'error');
                return;
            }

            gtag('event', 'conversion', {
                send_to: 'G-XXXXXXXXXX',
                event_category: 'test_conversion',
                event_label: 'analytics_test'
            });
            
            log('发送转化事件', 'success');
        }

        // 测试搜索
        function testSearch() {
            const searchInput = document.getElementById('test-search');
            const query = searchInput.value.trim();
            
            if (!query) {
                log('请输入搜索词', 'error');
                return;
            }

            if (typeof gtag === 'undefined') {
                log('测试失败: gtag未加载', 'error');
                return;
            }

            gtag('event', 'search', {
                search_term: query,
                event_category: 'site_search'
            });
            
            log(`发送搜索事件: "${query}"`, 'success');
        }

        // 自动跟踪外部链接
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a');
            if (link && link.hostname !== window.location.hostname) {
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'click', {
                        event_category: 'external_link',
                        event_label: link.href,
                        transport_type: 'beacon'
                    });
                    log(`跟踪外部链接点击: ${link.href}`, 'info');
                }
            }
        });

        // 页面加载完成后自动检查
        window.addEventListener('load', function() {
            setTimeout(checkAnalyticsStatus, 1000);
            log('页面加载完成，开始Analytics测试', 'info');
        });

        // 跟踪页面停留时间
        let startTime = Date.now();
        window.addEventListener('beforeunload', function() {
            const timeSpent = Math.round((Date.now() - startTime) / 1000);
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view_time', {
                    event_category: 'engagement',
                    value: timeSpent,
                    transport_type: 'beacon'
                });
            }
        });
    </script>
</body>
</html>