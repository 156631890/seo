<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics æµ‹è¯•é¡µé¢</title>
    
    <!-- Google Search Console éªŒè¯ -->
    <meta name="google-site-verification" content="IyyiuJxBRqr62v-cPzO7vqonf-d6v2rnzgNK8HzO1Bs" />
    
    <!-- Google Analytics (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX');
    </script>
    
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; }
        .test-section { background: #f8f9fa; padding: 1.5rem; margin: 1rem 0; border-radius: 8px; }
        .test-button { background: #007bff; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; margin: 0.5rem; }
        .test-button:hover { background: #0056b3; }
        .status { padding: 0.5rem; margin: 0.5rem 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        #log { background: #f8f9fa; padding: 1rem; border-radius: 4px; max-height: 300px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ğŸ” Google Analytics æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ“Š Analytics çŠ¶æ€æ£€æŸ¥</h2>
        <div id="analytics-status"></div>
        <button class="test-button" onclick="checkAnalyticsStatus()">æ£€æŸ¥AnalyticsçŠ¶æ€</button>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ äº‹ä»¶è·Ÿè¸ªæµ‹è¯•</h2>
        <button class="test-button" onclick="testCustomEvent()">æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶</button>
        <button class="test-button" onclick="testPageView()">æµ‹è¯•é¡µé¢æµè§ˆ</button>
        <button class="test-button" onclick="testUserEngagement()">æµ‹è¯•ç”¨æˆ·å‚ä¸</button>
        <button class="test-button" onclick="testConversion()">æµ‹è¯•è½¬åŒ–äº‹ä»¶</button>
    </div>

    <div class="test-section">
        <h2>ğŸ”— é“¾æ¥è·Ÿè¸ªæµ‹è¯•</h2>
        <a href="https://google.com" target="_blank" class="test-button" style="text-decoration: none; display: inline-block;">æµ‹è¯•å¤–éƒ¨é“¾æ¥</a>
        <a href="/tools.html" class="test-button" style="text-decoration: none; display: inline-block;">æµ‹è¯•å†…éƒ¨é“¾æ¥</a>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æœç´¢æµ‹è¯•</h2>
        <input type="search" id="test-search" placeholder="è¾“å…¥æœç´¢è¯æµ‹è¯•..." style="padding: 0.5rem; margin-right: 0.5rem;">
        <button class="test-button" onclick="testSearch()">æµ‹è¯•æœç´¢</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
        <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="log"></div>
    </div>

    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.className = type;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // æ£€æŸ¥AnalyticsçŠ¶æ€
        function checkAnalyticsStatus() {
            const statusDiv = document.getElementById('analytics-status');
            
            if (typeof gtag === 'undefined') {
                statusDiv.innerHTML = '<div class="status error">âŒ Google Analytics æœªåŠ è½½</div>';
                log('Analyticsæ£€æŸ¥å¤±è´¥: gtagæœªå®šä¹‰', 'error');
                return;
            }

            if (typeof dataLayer === 'undefined') {
                statusDiv.innerHTML = '<div class="status error">âŒ dataLayer æœªåˆå§‹åŒ–</div>';
                log('Analyticsæ£€æŸ¥å¤±è´¥: dataLayeræœªå®šä¹‰', 'error');
                return;
            }

            statusDiv.innerHTML = '<div class="status success">âœ… Google Analytics æ­£å¸¸è¿è¡Œ</div>';
            log('AnalyticsçŠ¶æ€æ£€æŸ¥é€šè¿‡', 'success');
            
            // æ£€æŸ¥é…ç½®
            log(`dataLayeré•¿åº¦: ${dataLayer.length}`, 'info');
            log(`æœ€æ–°dataLayeræ¡ç›®: ${JSON.stringify(dataLayer[dataLayer.length - 1])}`, 'info');
        }

        // æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶
        function testCustomEvent() {
            if (typeof gtag === 'undefined') {
                log('æµ‹è¯•å¤±è´¥: gtagæœªåŠ è½½', 'error');
                return;
            }

            gtag('event', 'test_custom_event', {
                event_category: 'testing',
                event_label: 'analytics_test_page',
                value: 1
            });
            
            log('å‘é€è‡ªå®šä¹‰äº‹ä»¶: test_custom_event', 'success');
        }

        // æµ‹è¯•é¡µé¢æµè§ˆ
        function testPageView() {
            if (typeof gtag === 'undefined') {
                log('æµ‹è¯•å¤±è´¥: gtagæœªåŠ è½½', 'error');
                return;
            }

            gtag('config', 'G-XXXXXXXXXX', {
                page_title: 'Analytics Test Page',
                page_location: window.location.href
            });
            
            log('å‘é€é¡µé¢æµè§ˆäº‹ä»¶', 'success');
        }

        // æµ‹è¯•ç”¨æˆ·å‚ä¸
        function testUserEngagement() {
            if (typeof gtag === 'undefined') {
                log('æµ‹è¯•å¤±è´¥: gtagæœªåŠ è½½', 'error');
                return;
            }

            gtag('event', 'engagement_time', {
                name: 'engagement_time',
                value: 30000 // 30ç§’
            });
            
            log('å‘é€ç”¨æˆ·å‚ä¸äº‹ä»¶: 30ç§’', 'success');
        }

        // æµ‹è¯•è½¬åŒ–äº‹ä»¶
        function testConversion() {
            if (typeof gtag === 'undefined') {
                log('æµ‹è¯•å¤±è´¥: gtagæœªåŠ è½½', 'error');
                return;
            }

            gtag('event', 'conversion', {
                send_to: 'G-XXXXXXXXXX',
                event_category: 'test_conversion',
                event_label: 'analytics_test'
            });
            
            log('å‘é€è½¬åŒ–äº‹ä»¶', 'success');
        }

        // æµ‹è¯•æœç´¢
        function testSearch() {
            const searchInput = document.getElementById('test-search');
            const query = searchInput.value.trim();
            
            if (!query) {
                log('è¯·è¾“å…¥æœç´¢è¯', 'error');
                return;
            }

            if (typeof gtag === 'undefined') {
                log('æµ‹è¯•å¤±è´¥: gtagæœªåŠ è½½', 'error');
                return;
            }

            gtag('event', 'search', {
                search_term: query,
                event_category: 'site_search'
            });
            
            log(`å‘é€æœç´¢äº‹ä»¶: "${query}"`, 'success');
        }

        // è‡ªåŠ¨è·Ÿè¸ªå¤–éƒ¨é“¾æ¥
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a');
            if (link && link.hostname !== window.location.hostname) {
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'click', {
                        event_category: 'external_link',
                        event_label: link.href,
                        transport_type: 'beacon'
                    });
                    log(`è·Ÿè¸ªå¤–éƒ¨é“¾æ¥ç‚¹å‡»: ${link.href}`, 'info');
                }
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(checkAnalyticsStatus, 1000);
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹Analyticsæµ‹è¯•', 'info');
        });

        // è·Ÿè¸ªé¡µé¢åœç•™æ—¶é—´
        let startTime = Date.now();
        window.addEventListener('beforeunload', function() {
            const timeSpent = Math.round((Date.now() - startTime) / 1000);
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view_time', {
                    event_category: 'engagement',
                    value: timeSpent,
                    transport_type: 'beacon'
                });
            }
        });
    </script>
</body>
</html>