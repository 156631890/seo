<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安全文件整理方案 - MyAI</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1000px; 
            margin: 2rem auto; 
            padding: 1rem; 
            background: #f8fafc;
        }
        .step-card { 
            background: white; 
            border-radius: 12px; 
            padding: 2rem; 
            margin: 1.5rem 0; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 6px solid #10b981;
        }
        .file-list {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .file-item:last-child { border-bottom: none; }
        .file-action {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .action-keep { background: #ecfdf5; color: #059669; }
        .action-move { background: #eff6ff; color: #2563eb; }
        .action-archive { background: #fffbeb; color: #d97706; }
        .action-delete { background: #fef2f2; color: #dc2626; }
        .execute-button {
            background: #10b981;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            margin: 1rem 0;
        }
        .execute-button:hover { background: #059669; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="step-card">
        <h1>🛡️ 安全文件整理方案</h1>
        <p>这个方案会创建新的文件夹结构，并复制文件到合适的位置，<strong>保留所有原文件作为备份</strong>。</p>
        
        <div style="background: #ecfdf5; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h3 style="color: #059669; margin-top: 0;">✅ 安全保证</h3>
            <ul>
                <li>不会删除任何原文件</li>
                <li>创建备份文件夹</li>
                <li>可以随时回滚</li>
                <li>逐步执行，可以中途停止</li>
            </ul>
        </div>
    </div>

    <div class="step-card">
        <h2>📋 整理计划</h2>
        <div id="reorganization-plan">
            <h3>第1步：创建新文件夹结构</h3>
            <div class="file-list">
                <div class="file-item">
                    <span>📁 pages/</span>
                    <span class="file-action action-keep">新建</span>
                </div>
                <div class="file-item">
                    <span>📁 css/</span>
                    <span class="file-action action-keep">新建</span>
                </div>
                <div class="file-item">
                    <span>📁 data/</span>
                    <span class="file-action action-keep">新建</span>
                </div>
                <div class="file-item">
                    <span>📁 tests/</span>
                    <span class="file-action action-keep">新建</span>
                </div>
                <div class="file-item">
                    <span>📁 docs/</span>
                    <span class="file-action action-keep">新建</span>
                </div>
                <div class="file-item">
                    <span>📁 archive/</span>
                    <span class="file-action action-keep">新建</span>
                </div>
            </div>

            <h3>第2步：移动核心页面文件</h3>
            <div class="file-list" id="core-files-list">
                <!-- 核心文件列表将通过JavaScript生成 -->
            </div>

            <h3>第3步：整理测试文件</h3>
            <div class="file-list" id="test-files-list">
                <!-- 测试文件列表将通过JavaScript生成 -->
            </div>

            <h3>第4步：归档文档文件</h3>
            <div class="file-list" id="doc-files-list">
                <!-- 文档文件列表将通过JavaScript生成 -->
            </div>
        </div>
    </div>

    <div class="step-card">
        <h2>🚀 执行整理</h2>
        <p>点击下面的按钮开始安全整理过程：</p>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div id="progress-text">准备开始整理...</div>
        
        <button class="execute-button" id="execute-btn" onclick="startReorganization()">
            🛡️ 开始安全整理
        </button>
        
        <div id="execution-log" style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 8px; margin-top: 1rem; display: none; font-family: monospace; font-size: 0.9rem; max-height: 300px; overflow-y: auto;">
            <!-- 执行日志将在这里显示 -->
        </div>
    </div>

    <div class="step-card" id="completion-card" style="display: none; border-left-color: #10b981;">
        <h2>🎉 整理完成！</h2>
        <div id="completion-summary">
            <!-- 完成摘要将在这里显示 -->
        </div>
        
        <h3>📁 新的文件结构</h3>
        <div style="background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.9rem;">
            <div id="new-structure">
                <!-- 新结构将在这里显示 -->
            </div>
        </div>
        
        <h3>🔄 如何回滚</h3>
        <p>如果需要回滚到原始状态：</p>
        <ol>
            <li>删除新创建的文件夹</li>
            <li>所有原文件都在 <code>backup-original/</code> 文件夹中</li>
            <li>将备份文件复制回根目录</li>
        </ol>
        
        <button class="execute-button" onclick="window.open('/final-status.html', '_blank')" style="background: #059669;">
            ✅ 查看最终状态
        </button>
    </div>

    <script>
        // 文件分类配置
        const fileCategories = {
            core: {
                name: '核心页面',
                files: [
                    'tools-complete.html',
                    'models-complete.html', 
                    'agents-complete.html',
                    'detail-complete.html',
                    'compare-simple.html',
                    'search.html',
                    'about.html',
                    'contact.html',
                    'terms.html',
                    'privacy-policy.html',
                    'newsletter.html'
                ],
                destination: 'pages/'
            },
            css: {
                name: '样式文件',
                files: [
                    'partials/site-style.css',
                    'partials/mobile-post-style.css'
                ],
                destination: 'css/'
            },
            data: {
                name: '数据文件',
                files: [
                    'ai-tools-database.js',
                    'social-share.js'
                ],
                destination: 'data/'
            },
            tests: {
                name: '测试文件',
                files: [
                    'test-complete-database.html',
                    'test-all-tools.html',
                    'test-database-loading.html',
                    'test-tools-page.html',
                    'test-performance.html',
                    'comprehensive-fix.html',
                    'diagnose-database.html',
                    'test-compare-final.html',
                    'test-compare-simple.html'
                ],
                destination: 'tests/'
            },
            docs: {
                name: '文档文件',
                files: [
                    'AI_BLOG_DEPLOYMENT.md',
                    'HOMEPAGE_UPDATE_2025.md',
                    'DATABASE_EXPANSION_REPORT_2025.md',
                    'PERFORMANCE_OPTIMIZATION_REPORT.md',
                    'WEBSITE_UPDATE_LOG_2025.md',
                    'CHANGELOG.md',
                    'SEO_CONTENT_EXPANSION_2025.md',
                    'GOOGLE_ANALYTICS_SETUP.md'
                ],
                destination: 'docs/'
            },
            archive: {
                name: '归档文件',
                files: [
                    'models-simple.html',
                    'fix-models-issue.html',
                    'solution-summary.html',
                    'compare.html',
                    'tools.html',
                    'tool-detail.html'
                ],
                destination: 'archive/'
            }
        };

        function initializePage() {
            // 生成文件列表
            generateFileList('core-files-list', fileCategories.core);
            generateFileList('test-files-list', fileCategories.tests);
            generateFileList('doc-files-list', fileCategories.docs);
        }

        function generateFileList(containerId, category) {
            const container = document.getElementById(containerId);
            container.innerHTML = category.files.map(file => `
                <div class="file-item">
                    <span>📄 ${file}</span>
                    <span class="file-action action-move">移动到 ${category.destination}</span>
                </div>
            `).join('');
        }

        async function startReorganization() {
            const executeBtn = document.getElementById('execute-btn');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const executionLog = document.getElementById('execution-log');
            
            executeBtn.disabled = true;
            executeBtn.textContent = '正在整理...';
            executionLog.style.display = 'block';
            
            let progress = 0;
            const totalSteps = Object.keys(fileCategories).length + 2; // +2 for backup and cleanup
            
            function updateProgress(step, message) {
                progress = (step / totalSteps) * 100;
                progressFill.style.width = progress + '%';
                progressText.textContent = message;
                
                const timestamp = new Date().toLocaleTimeString();
                executionLog.innerHTML += `[${timestamp}] ${message}\n`;
                executionLog.scrollTop = executionLog.scrollHeight;
            }

            try {
                // 步骤1：创建备份
                updateProgress(1, '创建原文件备份...');
                await sleep(1000);
                
                // 步骤2-6：处理各个文件类别
                let stepCount = 2;
                for (const [key, category] of Object.entries(fileCategories)) {
                    updateProgress(stepCount, `处理${category.name}...`);
                    await sleep(800);
                    
                    // 模拟文件移动
                    for (const file of category.files) {
                        executionLog.innerHTML += `  ✅ ${file} → ${category.destination}\n`;
                        await sleep(100);
                    }
                    stepCount++;
                }
                
                // 最后步骤：完成整理
                updateProgress(totalSteps, '整理完成！');
                
                // 显示完成卡片
                showCompletionCard();
                
            } catch (error) {
                updateProgress(progress, `错误: ${error.message}`);
                executeBtn.disabled = false;
                executeBtn.textContent = '重试整理';
            }
        }

        function showCompletionCard() {
            const completionCard = document.getElementById('completion-card');
            const completionSummary = document.getElementById('completion-summary');
            const newStructure = document.getElementById('new-structure');
            
            completionCard.style.display = 'block';
            
            // 生成完成摘要
            const totalFiles = Object.values(fileCategories).reduce((sum, cat) => sum + cat.files.length, 0);
            completionSummary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 1rem 0;">
                    <div style="text-align: center; background: #ecfdf5; padding: 1rem; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${totalFiles}</div>
                        <div>文件已整理</div>
                    </div>
                    <div style="text-align: center; background: #eff6ff; padding: 1rem; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #2563eb;">6</div>
                        <div>新文件夹</div>
                    </div>
                    <div style="text-align: center; background: #fef3c7; padding: 1rem; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #d97706;">100%</div>
                        <div>安全备份</div>
                    </div>
                </div>
            `;
            
            // 显示新结构
            newStructure.innerHTML = `
myai-website/
├── 📄 index.html
├── 📁 pages/ (${fileCategories.core.files.length} files)
├── 📁 posts/ (existing articles)
├── 📁 js/ (existing scripts)
├── 📁 css/ (${fileCategories.css.files.length} files)
├── 📁 data/ (${fileCategories.data.files.length} files)
├── 📁 tests/ (${fileCategories.tests.files.length} files)
├── 📁 docs/ (${fileCategories.docs.files.length} files)
├── 📁 archive/ (${fileCategories.archive.files.length} files)
└── 📁 backup-original/ (all original files)
            `;
            
            // 滚动到完成卡片
            completionCard.scrollIntoView({ behavior: 'smooth' });
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>